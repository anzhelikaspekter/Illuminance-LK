<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Change Password">
    <title>Change Password</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/style.min.css">
</head>

<body>
    <section class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
        <div class="modal__wrap">
            <button type="button" class="modal__close" aria-label="Close modal">
                <img src="img/icon/close.svg" width="18" height="18" alt="Close icon">
            </button>

            <header class="modal__header">
                <div class="modal__icon-wrap classic" aria-label="Change Password">
                    <img src="img/icon/password.svg" width="18" height="18" alt="Password icon">
                </div>
            </header>

            <div class="modal__content">
                <div class="modal__title-wrap">
                    <h1 id="modal-title" class="modal__title">Change Password</h1>
                </div>

                <form action="" method="post" class="modal__form">
                    <div class="modal__form-wrap">
                        <label for="current-password" class="modal__form-wrap--label">Current Password</label>
                        <input type="password" id="current-password" name="current-password"
                            placeholder="Enter your password" class="modal__form-wrap--input">
                        <button type="button" class="modal__form-wrap--toggle" aria-label="Show password">
                            <img src="img/icon/show.svg" width="20" height="20" alt="" class="modal__form-wrap--icon">
                        </button>
                    </div>

                    <div class="modal__form-wrap">
                        <label for="new-password" class="modal__form-wrap--label">New Password</label>
                        <input type="password" id="new-password" name="new-password"
                            placeholder="Create a new secure password" class="modal__form-wrap--input">
                        <button type="button" class="modal__form-wrap--toggle" aria-label="Show password">
                            <img src="img/icon/show.svg" width="20" height="20" alt="" class="modal__form-wrap--icon">
                        </button>
                    </div>

                    <div class="modal__form-wrap">
                        <label for="confirm-current-password" class="modal__form-wrap--label">Confirm New
                            Password</label>
                        <input type="password" id="confirm-current-password" name="confirm-current-password"
                            placeholder="Re-enter your new password" class="modal__form-wrap--input"
                            aria-describedby="password-error">
                        <button type="button" class="modal__form-wrap--toggle" aria-label="Show password">
                            <img src="img/icon/show.svg" width="20" height="20" alt="" class="modal__form-wrap--icon">
                        </button>
                    </div>

                    <p class="modal__form-wrap--error" id="password-error" aria-live="polite" hidden></p>

                    <button type="button" class="modal__btn" aria-label="Save Changes">Save Changes</button>
                </form>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener("pageLoaded", () => {
            const modal = document.querySelector(".modal");
            const wrap = modal.querySelector(".modal__wrap");
            const closeBtn = modal.querySelector(".modal__close");

            function closeModal() {
                if (window.parent && window.parent !== window) {
                    window.parent.postMessage({ action: "closeModal" }, "*");
                } else {
                    window.history.back();
                }
            }

            closeBtn.addEventListener("click", closeModal);

            modal.addEventListener("click", (e) => {
                if (!wrap.contains(e.target)) {
                    closeModal();
                }
            });
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const toggleButtons = document.querySelectorAll(".modal__form-wrap--toggle");
            const saveButton = document.querySelector(".modal__btn");
            const newPass = document.getElementById("new-password");
            const confirmPass = document.getElementById("confirm-current-password");
            const errorMsg = document.getElementById("password-error");

            toggleButtons.forEach((btn) => {
                btn.addEventListener("click", () => {
                    const wrap = btn.closest(".modal__form-wrap");
                    const input = wrap.querySelector(".modal__form-wrap--input");
                    const icon = btn.querySelector(".modal__form-wrap--icon");

                    if (input.type === "password") {
                        input.type = "text";
                        btn.setAttribute("aria-label", "Hide password");
                        icon.src = "img/icon/hide.svg";
                    } else {
                        input.type = "password";
                        btn.setAttribute("aria-label", "Show password");
                        icon.src = "img/icon/show.svg";
                    }
                });
            });

            function validatePasswords() {
                const newVal = newPass.value.trim();
                const confirmVal = confirmPass.value.trim();

                if (confirmVal && newVal !== confirmVal) {
                    errorMsg.textContent = "Passwords do not match";
                    errorMsg.hidden = false;
                    errorMsg.style.color = "var(--error-color, #d33)";
                    confirmPass.setAttribute("aria-invalid", "true");
                    saveButton.disabled = true;
                } else if (confirmVal && newVal === confirmVal) {
                    errorMsg.textContent = "Passwords match";
                    errorMsg.hidden = false;
                    errorMsg.style.color = "var(--success-color, green)";
                    confirmPass.removeAttribute("aria-invalid");
                    saveButton.disabled = false;
                } else {
                    errorMsg.hidden = true;
                    confirmPass.removeAttribute("aria-invalid");
                    saveButton.disabled = false;
                }
            }

            newPass.addEventListener("input", validatePasswords);
            confirmPass.addEventListener("input", validatePasswords);
        });
    </script>
</body>

</html>