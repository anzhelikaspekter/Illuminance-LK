<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Main page Illuminance">
    <title>Illuminance</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/style.min.css">
</head>

<body style="background-color: var(--bg-color);">
    <header class="topbar">
        <nav class="topbar__nav" role="navigation" aria-label="Main navigation">
            <ul class="topbar__list">
                <li class="topbar__item">
                    <button type="button" class="topbar__btn btn-icon" aria-pressed="false" aria-label="Open sidebar">
                        <img src="img/icon/sidebar-mobile.svg" width="20" height="20" alt="Open Sidebar"
                            class="topbar__icon" aria-hidden="true">
                    </button>
                </li>
                <li class="topbar__item">
                    <button type="button" class="topbar__btn active" aria-pressed="true" aria-current="page"
                        data-name="dashboard" data-page="dashboard">
                        <div class="topbar__icon"></div>
                        <span class="topbar__label">Dashboard</span>
                    </button>
                </li>
                <li class="topbar__item">
                    <button type="button" class="topbar__btn" aria-pressed="false" data-name="referral"
                        data-page="referral">
                        <div class="topbar__icon"></div>
                        <span class="topbar__label">Referral <span>Program</span></span>
                    </button>
                </li>
                <li class="topbar__item">
                    <button type="button" class="topbar__btn" aria-pressed="false" data-name="deposit"
                        data-page="deposit">
                        <div class="topbar__icon"></div>
                        <span class="topbar__label">Deposit</span>
                    </button>
                </li>
                <li class="topbar__item">
                    <button type="button" class="topbar__btn" aria-pressed="false" data-name="credit"
                        data-page="credit">
                        <div class="topbar__icon"></div>
                        <span class="topbar__label">Credit <span>Deposit</span></span>
                    </button>
                </li>
            </ul>

            <ul class="topbar__nav-list">
                <li class="topbar__nav-item">
                    <button type="button" class="topbar__btn btn-select-icon" aria-label="Select language"
                        aria-haspopup="listbox" aria-expanded="false" data-modal="language">
                        <img src="img/icon/us.svg" width="20" height="20" alt="US" class="topbar__icon circle"
                            aria-hidden="true">
                        <img src="img/icon/arrow-down-fill.svg" width="20" height="20" alt="Open Language"
                            class="topbar__icon" aria-hidden="true">
                    </button>
                </li>
                <li class="topbar__nav-item">
                    <button type="button" class="topbar__btn btn-icon" aria-label="Open notifications"
                        data-modal="notification-empty">
                        <img src="img/icon/notification.svg" width="20" height="20" alt="Open Notifications"
                            class="topbar__icon notice" aria-hidden="true">
                    </button>
                </li>
                <li class="topbar__nav-item">
                    <button type="button" class="topbar__btn btn-user" aria-label="Open user menu" data-page="profile">
                        <img src="img/user.webp" width="20" height="20" alt="Avatar" class="topbar__nav-avatar notice"
                            aria-hidden="true">
                        <img src="img/icon/check-success.svg" width="12" height="12" alt="Verification Success"
                            class="topbar__nav-user-check" aria-hidden="true">
                    </button>
                </li>
            </ul>
        </nav>
    </header>

    <aside class="sidebar">
        <img src="img/logo.svg" width="150" height="16" alt="Illuminance logo" class="sidebar__logo">
        <div class="sidebar__total-balance-card">
            <div class="sidebar__total-balance-card-title-wrap">
                <h2 class="sidebar__total-balance-card-title">Total balance</h2>
                <p class="sidebar__total-balance-card-sum">$12,374<span class="end">.87</span></p>
            </div>

            <div class="sidebar__total-balance-btns-wrap">
                <button type="button" class="sidebar__total-balance-btn primary" data-modal="deposit-modal">
                    Deposit
                </button>

                <button type="button" class="sidebar__total-balance-btn" data-modal="withdraw">
                    Withdraw
                </button>

                <button type="button" class="sidebar__total-balance-btn exchange" data-modal="exchange"
                    aria-label="Exchange">
                    <img src="img/icon/sidebar-exchange.svg" width="20" height="20" alt="Exchange"
                        class="sidebar__total-balance-icon">
                </button>
            </div>

            <button type="button" class="sidebar__total-balance-btn" data-modal="referral-code"
                aria-label="Open referral code">
                <img src="img/sidebar-qr.svg" width="32" height="32" alt="QR-code" class="sidebar__total-balance-qr">
                <div class="sidebar__total-balance-title-wrap">
                    <p class="sidebar__total-balance-desc light">My referral code</p>
                    <p class="sidebar__total-balance-desc">Share your QR code.</p>
                </div>
                <img src="img/icon/arrow-right.svg" width="18" height="18" alt="Arrow right"
                    class="sidebar__total-balance-icon">
            </button>
        </div>
        <div class="sidebar__assets">
            <div class="sidebar__assets-title-wrap">
                <h2 class="sidebar__assets-title">Assets</h2>
                <button type="button" class="sidebar__assets-btn">Show <img src="img/icon/arrow-down.svg" width="18"
                        height="18" alt="Show" class="sidebar__assets-icon" aria-expanded="false"
                        aria-controls="assets-list"></button>
            </div>

            <ul id="assets-list" class="sidebar__assets-list" role="list">
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/eth.svg" width="36" height="36" alt="ETH"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Ethereum</p>
                            <p class="sidebar__assets-network-desc">0.012 ETH</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="30.00">$30.00</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/dot.svg" width="36" height="36" alt="DOT"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Polkadot</p>
                            <p class="sidebar__assets-network-desc">0.020 DOT</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="27.50">$27.50</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/sol.svg" width="36" height="36" alt="SOL"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Solana</p>
                            <p class="sidebar__assets-network-desc">0.008 SOL</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="25.75">$25.75</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/link.svg" width="36" height="36" alt="LINK"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Chainlink</p>
                            <p class="sidebar__assets-network-desc">0.005 LINK</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="24.10">$24.10</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/xrp.svg" width="36" height="36" alt="XRP"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Ripple</p>
                            <p class="sidebar__assets-network-desc">0.015 XRP</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="22.40">$22.40</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/ada.svg" width="36" height="36" alt="ADA"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Cardano</p>
                            <p class="sidebar__assets-network-desc">0.007 ADA</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="20.30">$20.30</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/ltc.svg" width="36" height="36" alt="LTC"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Litecoin</p>
                            <p class="sidebar__assets-network-desc">0.010 LTC</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="18.90">$18.90</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/doge.svg" width="36" height="36" alt="DOGE"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Dogecoin</p>
                            <p class="sidebar__assets-network-desc">0.025 DOGE</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="15.00">$15.00</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/shib.svg" width="36" height="36" alt="SHIB"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Shiba Inu</p>
                            <p class="sidebar__assets-network-desc">0.030 SHIB</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="12.50">$12.50</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/btc.svg" width="36" height="36" alt="BTC"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Bitcoin</p>
                            <p class="sidebar__assets-network-desc">0.020 BTC</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="11.50">$11.50</data>
                </li>
                <li class="sidebar__assets-item" role="listitem">
                    <div class="sidebar__assets-network-field">
                        <img src="img/icon/sol.svg" width="36" height="36" alt="SOL"
                            class="sidebar__assets-network-icon">
                        <div class="sidebar__assets-network-title-wrap">
                            <p class="sidebar__assets-network-title">Solana</p>
                            <p class="sidebar__assets-network-desc">0.008 SOL</p>
                        </div>
                    </div>
                    <data class="sidebar__assets-sum" value="25.75">$25.75</data>
                </li>
            </ul>
        </div>
    </aside>

    <main class="content">
    </main>

    <footer class="tapbar" role="navigation" aria-label="Main navigation">
        <ul class="tapbar__list">
            <li class="tapbar__item">
                <button type="button" class="tapbar__btn active" aria-pressed="true" aria-current="page"
                    data-name="dashboard" data-page="dashboard">
                    <div class="tapbar__icon"></div>
                    <span class="tapbar__label">Dashboard</span>
                </button>
            </li>
            <li class="tapbar__item">
                <button type="button" class="tapbar__btn" aria-pressed="false" data-name="referral"
                    data-page="referral">
                    <div class="tapbar__icon"></div>
                    <span class="tapbar__label">Referral</span>
                </button>
            </li>
            <li class="tapbar__item">
                <button type="button" class="tapbar__btn" aria-pressed="false" data-name="deposit" data-page="deposit">
                    <div class="tapbar__icon"></div>
                    <span class="tapbar__label">Deposit</span>
                </button>
            </li>
            <li class="tapbar__item">
                <button type="button" class="tapbar__btn" aria-pressed="false" data-name="credit" data-page="credit">
                    <div class="tapbar__icon"></div>
                    <span class="tapbar__label">Credit</span>
                </button>
            </li>
        </ul>
    </footer>

    <div id="modal-container" allowtransparency="true"></div>

    <!-- Loading modals -->
    <script>
        document.querySelectorAll("[data-modal]").forEach((btn) => {
            btn.addEventListener("click", () => {
                const modalPage = btn.getAttribute("data-modal");
                const iframe = document.createElement("iframe");
                iframe.src = `${modalPage}.html`;
                iframe.className = "modal-iframe";
                iframe.allowTransparency = true;
                iframe.style.background = "transparent";

                document.body.appendChild(iframe);

                const handleMessage = (e) => {
                    if (e.data.action === "closeModal" || e.data.action === "clickOutside") {
                        iframe.remove();
                        window.removeEventListener("message", handleMessage);
                    }
                };

                window.addEventListener("message", handleMessage);
            });
        });

    </script>

    <!-- Button Assets -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const toggleBtn = document.querySelector(".sidebar__assets-btn");
            const assetsList = document.querySelector(".sidebar__assets-list");
            const arrowIcon = toggleBtn?.querySelector(".sidebar__assets-icon");
            if (!toggleBtn || !assetsList) return;

            toggleBtn.setAttribute("aria-expanded", "false");
            assetsList.hidden = true;
            assetsList.style.maxHeight = "none";
            assetsList.style.opacity = "1";

            toggleBtn.addEventListener("click", () => {
                const isExpanded = toggleBtn.getAttribute("aria-expanded") === "true";
                toggleBtn.setAttribute("aria-expanded", String(!isExpanded));

                if (isExpanded) {
                    assetsList.hidden = true;
                    arrowIcon.style.transform = "rotate(0deg)";
                    toggleBtn.childNodes[0].nodeValue = "Show ";
                } else {
                    assetsList.hidden = false;
                    arrowIcon.style.transform = "rotate(180deg)";
                    toggleBtn.childNodes[0].nodeValue = "Hide ";
                }
            });
        });
    </script>

    <!-- Navigation -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const navButtons = document.querySelectorAll(".topbar__btn[data-name], .tapbar__btn[data-name]");

            const resetAll = () => {
                navButtons.forEach((btn) => {
                    btn.classList.remove("active");
                    btn.setAttribute("aria-pressed", "false");
                    btn.removeAttribute("aria-current");
                });
            };

            const activateByName = (name) => {
                resetAll();
                navButtons.forEach((btn) => {
                    if (btn.dataset.name === name) {
                        btn.classList.add("active");
                        btn.setAttribute("aria-pressed", "true");
                        btn.setAttribute("aria-current", "page");
                    }
                });
                // сохраняем только если не dashboard, чтобы не залипало
                if (name !== "dashboard") {
                    localStorage.setItem("activePage", name);
                } else {
                    localStorage.removeItem("activePage");
                }
            };

            const hash = location.hash.replace("#", "");
            const stored = localStorage.getItem("activePage");

            let currentPage;

            // ✅ если есть хеш — используем его,
            // ✅ если нет хеша и страница загружается впервые — dashboard,
            // ✅ localStorage применяем только если есть hash или hash == stored.
            if (hash) {
                currentPage = hash;
            } else {
                currentPage = "dashboard";
            }

            activateByName(currentPage);

            navButtons.forEach((btn) => {
                const name = btn.dataset.name;
                btn.addEventListener("click", () => {
                    if (!btn.classList.contains("active")) {
                        activateByName(name);
                        location.hash = name;
                    }
                });
            });

            window.addEventListener("hashchange", () => {
                const newHash = location.hash.replace("#", "");
                if (newHash) activateByName(newHash);
                else activateByName("dashboard");
            });

            const originalLoadPage = window.loadPage;
            if (typeof originalLoadPage === "function") {
                window.loadPage = async (page) => {
                    await originalLoadPage(page);
                    activateByName(page);
                };
            }
        });
    </script>

    <!-- Sidebar -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const sidebar = document.querySelector(".sidebar");
            const sidebarToggle = document.querySelector(
                '.topbar__btn[aria-label="Open sidebar"]'
            );

            if (!sidebar || !sidebarToggle) return;
            let isSidebarOpen = false;

            const toggleSidebar = (forceClose = false) => {
                isSidebarOpen = forceClose ? false : !isSidebarOpen;
                sidebar.style.display = isSidebarOpen ? "flex" : "none";
                sidebarToggle.setAttribute("aria-pressed", isSidebarOpen);
                sidebarToggle.setAttribute("aria-expanded", isSidebarOpen);
            };

            sidebarToggle.addEventListener("click", (e) => {
                e.stopPropagation();
                toggleSidebar();
            });

            document.addEventListener("click", (e) => {
                if (
                    isSidebarOpen &&
                    !sidebar.contains(e.target) &&
                    !sidebarToggle.contains(e.target)
                ) {
                    toggleSidebar(true);
                }
            });

            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape" && isSidebarOpen) toggleSidebar(true);
            });
        });
    </script>

    <!-- Global loadPage function with preloader -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const content = document.querySelector(".content");
            const pageButtons = document.querySelectorAll("[data-page]");
            if (!content) return;

            const loaderHTML = `
                <div class="loader" role="status" aria-label="Loading">
                    <div class="loader__spinner"></div>
                    <span class="loader__text">Loading...</span>
                </div>`;

            window.loadPage = async (page) => {
                try {
                    content.innerHTML = loaderHTML;

                    const response = await fetch(`${page}.html`);
                    if (!response.ok) throw new Error("Page not found");
                    const html = await response.text();

                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, "text/html");

                    content.innerHTML = doc.body.innerHTML;

                    const scripts = doc.querySelectorAll("script");

                    setTimeout(() => {
                        scripts.forEach(oldScript => {
                            const newScript = document.createElement("script");

                            if (oldScript.src) {
                                newScript.src = oldScript.src;
                                newScript.async = false;
                            } else {
                                newScript.textContent = oldScript.textContent;
                            }

                            document.body.appendChild(newScript);
                        });

                        document.dispatchEvent(new Event("pageLoaded"));

                        document.title =
                            page.charAt(0).toUpperCase() + page.slice(1) + " | Illuminance";

                    }, 0);
                } catch (err) {
                    content.innerHTML = `
                        <div class="error-message">
                            <p>⚠️ Failed to load <strong>${page}.html</strong></p>
                            <p>${err.message}</p>
                        </div>`;
                }
            };

            const initialPage = location.hash.replace("#", "") || "dashboard";
            window.loadPage(initialPage);

            if (pageButtons.length) {
                pageButtons.forEach((btn) => {
                    btn.addEventListener("click", () => {
                        const page = btn.dataset.page;
                        if (!page) return;
                        window.loadPage(page);
                        history.pushState({ page }, "", `#${page}`);
                    });
                });
            }

            window.addEventListener("popstate", (e) => {
                const page = e.state?.page || "dashboard";
                window.loadPage(page);
            });
        });
    </script>

    <!-- Delegate for clicks on data-page on loaded pages -->
    <script>
        document.addEventListener("click", (e) => {
            const btn = e.target.closest("[data-page]");
            if (!btn) return;

            e.preventDefault();
            const page = btn.dataset.page;
            if (!page) return;

            if (typeof window.loadPage === "function") {
                window.loadPage(page);
                history.pushState({ page }, "", `#${page}`);
            } else {
                window.location.href = `${page}.html`;
            }
        });
    </script>
</body>

</html>